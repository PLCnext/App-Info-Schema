{
  "title": "App Info File",
  "description": "A configuration file containing all necessary information to integrate a PLCnext Control App",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "plcnextapp": {
      "type": "object",
      "description": "Metadata of the app",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the app.\nShould correspond to the name used in the PLCnext Store."
        },
        "identifier": {
          "type": "string",
          "minLength": 14,
          "maxLength": 14,
          "pattern": "^\\d+$",
          "description": "An unique app identifier, that gets generated by the PLCnext Store on app creation.\nMust be a string of 14 digits.",
          "examples": [
            "11111111111111",
            "12341234123412"
          ]
        },
        "version": {
          "type": "string",
          "description": "Version of the app."
        },
        "target": {
          "type": "string",
          "pattern": "^(?:[\\w()][\\w\\- ()]*[\\w()])(?:,[\\w()][\\w\\- ()]*[\\w()])*$",
          "description": "The devices this app is intended to run on.\nMust be a comma separated string without additional characters or spaces around the separator.\nSupported from firmware 21.0.0",
          "examples": [
            "AXC F 2152",
            "AXC F 2152,AXC F 3152"
          ]
        },
        "minfirmware_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Minimally required firmware to run the app.\nMust be in the format <major>.<minor>.<fixes> e.g. '2023.0.0'.",
          "examples": [
            "2023.3.0",
            "2025.0.0",
            "25.0.0"
          ]
        },
        "manufacturer": {
          "type": "string",
          "default": "",
          "description": "Name of the manufacturer. (optional)\nDefaults to an empty string.\nSupported from firmware 19.3.0"
        },
        "licensetype": {
          "type": "string",
          "default": "Free",
          "description": "License type of the app. (optional)\nDefaults to 'Free'\nSupported from firmware 20.0.0",
          "enum": [
            "Free",
            "Full",
            "Limited"
          ]
        },
        "linkToAppPage": {
          "type": "string",
          "maxLength": 512,
          "description": "URL to an individual web page of the app. (optional)\nLimited to a string of 512 characters.\nSupported from firmware 25.0.0"
        },
        "additionalInfo": {
          "type": "array",
          "description": "Additional information needed to describe the app. (optional)\nSupported from firmware 25.0.0",
          "items": {
            "type": "object",
            "properties": {
              "key": {
                "type": "string",
                "maxLength": 256,
                "description": "Identifier of the item.\nLimited to a string of 256 characters."
              },
              "value": {
                "type": "string",
                "maxLength": 256,
                "description": "Text information of the item.\nLimited to a string of 256 characters."
              },
              "url": {
                "type": "string",
                "maxLength": 512,
                "description": "Link to an additional resource related to the app. (required when type is 'ExternalLink', 'LocalLink' or 'PortLink')\nLimited to a string of 512 characters."
              },
              "type": {
                "type": "string",
                "description": "Describes the type of information the item holds.",
                "enum": [
                  "InfoText",
                  "ExternalLink",
                  "LocalLink",
                  "PortLink"
                ]
              }
            },
            "required": [
              "key",
              "value",
              "type"
            ],
            "if": {
              "properties": {
                "type": {
                  "enum": [
                    "ExternalLink",
                    "LocalLink",
                    "PortLink"
                  ]
                }
              },
              "required": [
                "type"
              ]
            },
            "then": {
              "required": [
                "url"
              ]
            }
          }
        }
      },
      "required": [
        "name",
        "identifier",
        "version",
        "target",
        "minfirmware_version"
      ]
    },
    "engineerapp": {
      "type": "object",
      "description": "Configuration for a PLCnext Engineer project as part of the app. (optional)\nSupported from firmware 19.0.0",
      "properties": {
        "folder": {
          "$ref": "#/$defs/path",
          "description": "Path to the PLCnext Engineer directory within the app container.\nMust be a valid path.",
          "examples": [
            "/path/to/PCWE",
            "path/to/PCWE"
          ]
        }
      },
      "required": [
        "folder"
      ]
    },
    "cmdtools": {
      "type": "array",
      "description": "Configuration for command line tools as part of the app. (optional)\nSupported from firmware 19.3.0",
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "$ref": "#/$defs/path",
            "description": "Path to the executable file within the app container.\nMust be a valid path.",
            "examples": [
              "/path/to/binary",
              "path/to/script"
            ]
          }
        },
        "required": [
          "path"
        ]
      }
    },
    "plcnextextensions": {
      "type": "array",
      "description": "Configuration for PLCnext Technology Extensions as part of the app. (optional)\nSupported from firmware 19.3.0",
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "acfconfigpath": {
            "type": "string",
            "pattern": "^\/?[\\w\\-\\.]+(\/[\\w\\-\\.]+)*\\.acf\\.config$",
            "description": "Path to the ACF configuration file within the app container.\nMust be a valid path to a '*.acf.config' file.",
            "examples": [
              "/path/to/my.acf.config",
              "path/to/my.acf.config",
              "my.acf.config"
            ]
          }
        },
        "required": [
          "acfconfigpath"
        ]
      }
    },
    "linuxdaemons": {
      "type": "array",
      "description": "Configuration for linux daemons as part of the app. (optional)\nSupported from firmware 19.3.0 to 25.0.0",
      "deprecated": true,
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "$ref": "#/$defs/path",
            "description": "Path to the binary file of the daemon within the app container.\nMust be a valid path.",
            "examples": [
              "/path/to/daemon",
              "path/to/daemon"
            ]
          },
          "cmdargs": {
            "type": "string",
            "description": "Command line arguments passed to the daemon at startup."
          },
          "starttime": {
            "type": "string",
            "pattern": "^\\d+$",
            "description": "Start priority of the daemon.",
            "examples": [
              "1",
              "99"
            ]
          },
          "initScriptTemplate": {
            "$ref": "#/$defs/path",
            "description": "Path to a custom init script template instead of the provided one. (optional)\nMust be a valid path.",
            "examples": [
              "/path/to/script.sh",
              "path/to/script.sh"
            ]
          }
        },
        "required": [
          "path",
          "cmdargs",
          "starttime"
        ]
      }
    },
    "sharedlibs": {
      "type": "array",
      "description": "Configuration for shared libraries as part of the app. (optional)\nSupported from firmware 19.3.0 to 25.0.0",
      "deprecated": true,
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "libpath": {
            "$ref": "#/$defs/path",
            "description": "Path to the shared library within the app container.\nMust be a valid path to a '*.so' file.",
            "examples": [
              "/path/to/lib.so",
              "path/to/lib.so",
              "lib.so"
            ]
          }
        },
        "required": [
          "libpath"
        ]
      }
    },
    "ocicontainer": {
      "type": "object",
      "description": "Configuration for an OCI container as part of the app. (optional)\nSupported from firmware 25.0.0",
      "properties": {
        "quadletFiles": {
          "type": "array",
          "description": "Specifies podman unit (Quadlet) files.",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "$ref": "#/$defs/path",
                "description": "Path to a quadlet file.\nMust be a valid path.",
                "examples": [
                  "/path/to/unit.container",
                  "path/to/unit.pod",
                  "/path/to/unit.network"
                ]
              },
              "type": {
                "type": "string",
                "default": "Main",
                "description": "Type of the quadlet file. (optional)\nDefaults to 'Main'.",
                "enum": [
                  "Main",
                  "Dependency"
                ]
              }
            },
            "required": [
              "path"
            ]
          }
        },
        "environmentVariables": {
          "type": "array",
          "description": "Environment variables for the quadlet files as key-value pair. (optional)",
          "uniqueItems": true,
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the environment variable."
              },
              "value": {
                "type": "string",
                "description": "Value of the environment variable."
              }
            },
            "required": [
              "name",
              "value"
            ]
          }
        },
        "images": {
          "type": "array",
          "description": "Specifies container images to be used.",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the image."
              },
              "id": {
                "type": "string",
                "pattern": "^[a-fA-F0-9]{64}$",
                "description": "SHA-256 ID of the image.",
                "examples": [
                  "57f067446d29f661ee55e675aff86527f4817933f10592f6f3d34870b99fed04"
                ]
              },
              "path": {
                "type": "string",
                "pattern": "^\/?[\\w\\-\\.]+(\/[\\w\\-\\.]+)*\\.tar\\.gz$",
                "description": "Path to the exported image archive.\nMust be a valid path to a *.tar.gz file.",
                "examples": [
                  "/path/to/image.tar.gz",
                  "path/to/image.tar.gz"
                ]
              }
            },
            "required": [
              "name",
              "id",
              "path"
            ]
          }
        }
      },
      "required": [
        "quadletFiles",
        "images"
      ]
    },
    "datastorage": {
      "type": "object",
      "description": "Configuration for persistent and temporary directories to be used by all app components. (optional)\nSupported from firmware 19.3.0",
      "properties": {
        "persistentdata": {
          "type": "boolean",
          "description": "Boolean value for whether persisent memory is required."
        },
        "temporarydata": {
          "type": "boolean",
          "description": "Boolean value for whether temporary memory is required."
        },
        "directoriesToCreate": {
          "type": "object",
          "description": "Specifies paths for directories that will be created. (optional)\nSupported from firmware 25.0.0",
          "properties": {
            "temporary": {
              "type": "array",
              "description": "Specifies paths for temporary directories that will be created. (optional)",
              "uniqueItems": true,
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "$ref": "#/$defs/path",
                    "description": "Path to a temporary directory that will be created.",
                    "examples": [
                      "/path/to/temporary/dir",
                      "path/to/temporary/dir"
                    ]
                  }
                }
              }
            },
            "persistent": {
              "type": "array",
              "description": "Specifies paths for persistent directories that will be created. (optional)",
              "uniqueItems": true,
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "$ref": "#/$defs/path",
                    "description": "Path to a persistent directory that will be created.",
                    "examples": [
                      "/path/to/persistent/dir",
                      "path/to/persistent/dir"
                    ]
                  }
                }
              }
            }
          }
        }
      },
      "required": [
        "persistentdata",
        "temporarydata"
      ]
    },
    "plcnextservices": {
      "type": "array",
      "description": "Configuration of PLCnext Technology Runtime Services that the app needs. (optional)\nSupported from firmware 19.3.0",
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "service": {
            "type": "string",
            "description": "Identifier of the service.",
            "enum": [
              "WBM",
              "EHMI",
              "PROFINET DEVICE",
              "PROFINET CONTROLLER",
              "OPCUA",
              "FWM",
              "TRACING",
              "DATALOGGER",
              "IEC",
              "ETHERNET IP",
              "PROFICLOUD",
              "LINUX SYSLOG",
              "NETLOAD LIMITER",
              "SOFTWARE UPDATE",
              "GRPC LOCAL SERVER"
            ]
          },
          "action": {
            "type": "string",
            "description": "Setting of the service.",
            "enum": [
              "MUST_HAVE",
              "MUST_NOT_HAVE",
              "EXCLUSIVE_ACCESS"
            ]
          }
        },
        "required": [
          "service",
          "action"
        ]
      }
    },
    "updateconfigs": {
      "type": "object",
      "description": "Configuration for updating the app. (optional)\nSupported from firmware 20.0.0",
      "properties": {
        "autoupdate_enabled": {
          "type": "boolean",
          "description": "Allows the automatic update of the app."
        },
        "keep_persistentdata": {
          "type": "boolean",
          "description": "Sets whether to keep persistent data of the app. (optional)\nDefaults to 'false'.",
          "default": false
        },
        "keep_temporarydata": {
          "type": "boolean",
          "description": "Sets whether to keep temporary data of the app. (optional)\nDefaults to 'false'.",
          "default": false
        },
        "post_updatescript": {
          "$ref": "#/$defs/path",
          "description": "Path to a script that will be executed after the update. (optional)\nDefaults to 'n/a'.\nThe following parameters are passed as command line arguments:\n$1: App identifier\n$2: Absolute path to the mounted app directory\n$3: Absolute path to the persistent data directory of the app\n$4: Absolute path to the temporary data directory of the app",
          "default": "n/a",
          "examples": [
            "/path/to/script.sh",
            "path/to/script.sh"
          ]
        }
      },
      "required": [
        "autoupdate_enabled"
      ]
    }
  },
  "required": [
    "plcnextapp"
  ],
  "$defs": {
    "path": {
      "type": "string",
      "pattern": "^\/?[\\w\\-\\.]+(\/[\\w\\-\\.]+)*\/?$"
    }
  }
}
